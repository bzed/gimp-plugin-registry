====================== Separate+プラグイン Readme =====================

----- お急ぎの方向けメニュー
以下は「とにかくGIMPでCMYKデータを作りたいが、GIMPをインストールする以外
何もしていない」という場合に参照してください。

ただし、あくまでも急がば回れ、基礎知識なしに手順だけなぞっても、まともな
仕上がりは期待できませんのであしからず（Photoshopなどを使う場合も同じで
すよ！）。

※イントール方法についてはWindowsXPにGIMP 2.4.0以降が入っている環境を対象
に説明しています。

1.インストールするファイルの確認
このreadmeファイルがあるフォルダを起点にして、次の場所に必要ファイルが入
っています。

  (A)separate.exe、separate_import.exe、icc_colorspace.exe
     →bin\win32_gimp2.4 フォルダ
  (B)liblcms-1.dll
     →これは付属していませんので、Webブラウザで以下のアドレスよりダウ
       ンロードしてください。
       http://cue.yellowmagic.info/softwares/files/liblcms-1.dll.zip
  (C)ja.gmo
     →po フォルダ
  (D)quickproof.scm、quicksave.scm
     →sample-scripts\for_GIMP2.3+ フォルダ
  (E)sRGB Color Space Profile.icm
     →sRGB フォルダ
  (F)AdobeRGB1998.icc、JapanColor2001Coated.icc 他
     →これは付属していませんので、Webブラウザで以下のアドレスよりダウ
       ンロードしてください。
                           http://tinyurl.com/2d7qng
       使用許諾の文言が書かれたページに表示されますので、ページ末尾付近
       の「Accept」ボタンをクリックしてダウンロードページに移動してくだ
       さい。


2.インストール
前述の(A)〜(F)について説明します。

・(A)〜(D)
まず、GIMPをインストールしたフォルダを探してください。
通常は、フォルダのウインドウのアドレス欄に、「%PROGRAMFILES%\gimp-2.0」
と入力して移動すれば、そこがGIMPのインストールされた場所のはずですが、
複数のバージョンが混在している場合や、インストール場所をご自分で変えた
場合は違うことがありますので、一度確認してください。

各ファイルは、GIMPのインストールフォルダを起点に以下の場所にコピーしま
す。

─┬[ bin ] ←(B)
  │
  ├[ lib ]┬[ gimp ]─[2.0]─[ plug-ins  ] ←(A)
  │       │
  │       └[locale]─[ja ]─[LC_MESSAGES] ←(C)
  │
  ├[share]┬[ gimp ]─[2.0]─[  scripts  ] ←(D)
  ：       │
           └[locale]─[ja ]─[LC_MESSAGES] ←(C)

※1 (B)は同じ名前のファイルがbinフォルダにありますので、上書きするか、元
    のファイルを適当な名前に変更してからコピーしてください。

※2 (C)の場所はGIMPのバージョンによってどちらになるかが異なります。
    localeフォルダはlibかshareのどちらかにしかありませんので、それで判断
    してください。

※3 (C)はコピーした後、「gimp20-separate.mo」というファイル名に変更して
    ください。

・(E)
以下の場所をフォルダのウインドウのアドレス欄に入力、移動します。

%SYSTEMROOT%\system32\spool\drivers\color

その場所に同名のファイルがなければ(E)をコピーしてください。

・(F)
以下の場所をフォルダのウインドウのアドレス欄に入力、移動します。
移動できない場合は、(E)をコピーしたフォルダに移動してください。

%PROGRAMFILES%\Common Files\Adobe\Color\Profiles\Recommended

前述の通りにダウンロードしたファイルを解凍し、「RGB Profiles」「CMYK 
Profiles」フォルダに入っているファイル（合計15くらい）をこのフォルダにコ
ピーします。同名のファイルが既にある場合には、コピーする必要はありません。


3.環境設定
GIMPを起動し、環境設定ダイアログを開きます。そして、「色管理」をクリック
し、ダイアログ右側の各項目を設定します。

※GIMP2を使おうで配布されているローカライズファイルを入れていると、表記
が違うかもしれませんが、適当に推測して読み換えてください。

・操作のモード
	→色管理されたディスプレイ、または印刷シミュレーション
・RGBプロファイル
	→前述の(E)（ダイアログには「sRGB IEC61966-2.1」と表示されます）
・CMYKプロファイル
	→前述の(F)でコピーした、JapanColor2001Coated.iccというファイル
	  （ダイアログには「Japan Color 2001 Coated」と表示されます）
・モニタプロファイル
	→None
・Try to use the system monitor profile
	→オン（チェックを入れる）
・ディスプレイ描画方法
	→相対色距離
・印刷プロファイル
	→CMYKプロファイルと同じ
・ソフトプルーフ描画方法
	→相対色距離
・File open behaviour
	→Keep embedded profile


（以上で準備は終わりです）


4.カラーの確認
CMYK変換したい画像を開きます。環境設定の「操作のモード」が「色管理された
ディスプレイ」になっている場合には、画面上の表示は画像のカラーがお使いの
モニタに合わせてシミュレーションされます。

「色管理されたディスプレイ」から「印刷シミュレーション」に変更することで、
印刷結果のカラーの傾向を把握することができます（モニタの性能やその他の要
因のため、完全に再現できるわけではありません）。

元のカラーを印刷で再現するのは無理ですので、全体を見ながらバランスを整え
る方向で色調整をしてみてください。


5.CMYKデータを保存
カラーの確認・調整が済んだら、画像ウインドウのメニューバーから、「画像→
Separate→Quicksave」を選択しQuicksaveのダイアログを開きます。

ファイル名のところをクリックするとファイル選択ダイアログが開きますので、
変換後のファイルの保存場所とファイル名（拡張子は.tifにしてください）を
入力します。

Quicksaveダイアログの他のオプションはそのままにしてOKボタンをクリックす
れば、CMYK変換とTIFF形式での保存が完了します。指定の場所にファイルが保存
されているか確認してください。

元の画像に文字や枠線のレイヤーがあり、それをスミ乗せ処理したい場合には、
そのレイヤーをレイヤーダイアログ上で選択してから、Quicksaveを「Real 
black overprinting by the active layer」にチェックを入れて実行します。ス
ミ乗せの対象レイヤーが複数あるのであれば、あらかじめそれらを一つのレイヤ
ーに結合してください。

※Quicksaveは以下の処理を自動実行するスクリプトです。

・画像の複製
・レイヤーの統合
・CMYK変換（Separate+プラグインを呼び出し）
・（スミ乗せ処理）
・保存（Separate+プラグインを呼び出し）
・変換した画像を閉じる


（お急ぎの方向けメニュー終わり）


----- 概要
このプラグインは、The GIMP用のRGB→CMYK変換プラグインである、separate
（Alastair M. Robinson氏制作、バージョン0.3）を改変したものです。
おまけとして、Windowsにてビルド済みのバイナリを添付してあります。
オリジナルとの相違点は次の通りです。

・"Overprint Pure Black" オプションの不具合を修正
・Proofを実行する際、CMYKのレイヤーが揃っていないとクラッシュすることが
  ある不具合を修正
・プロファイルのパスが間違っていたり、プロファイルが破損していると強制終
  了する仕様を変更（メッセージを出力するだけで何もしない）
・Windows/MacOS向けに、ICCプロファイルのデフォルトパスを変更
・RGB→CMYK変換（Separate）とソフトプルーフ（Proof）のダイアログを分割
・画像に割り当てられたプロファイルをソースプロファイルとして取得するオプ
  ション
・色管理環境設定から初期値を取得するようにした（GIMP2.3以降）
・レンダリングインテントの指定と、黒点の補正オプション
・プルーフのモード（通常、黒インキのシミュレート、紙色のシミュレート）
・プルーフ画像にプロファイルを埋め込み（GIMP2.3以降）
・ダイアログ内レイアウトの整理
・2回目以降の使用時に、前回の設定が引き継がれるようにした（もちろん、
  GIMP本体を終了すると初期値に戻ります）
・保存ダイアログを新しいタイプ（GtkFileChooser）に変更
・TIFFファイルへの保存時にプロファイルを埋め込むか決められるようにした
・スクリプトから呼び出す際にも、全てのオプションを引数で指定できるように
  した（正常動作するかは未確認）
・主要なメッセージの日本語化
・"Overprint Pure Black" オプション使用時に黒の総インキ量が制限を越えな
  いようにした（20070115より）
・Separate(normal)とSeparate(to Colour)をひとつにまとめ、「擬似コンポジ
  ットを作成」オプションで切り替えられるようにした（20070115より）
・プロファイル選択用のダイアログを新設し、使い勝手が向上した（20070610
  より）
・プロファイル選択時に、ローカライズされたプロファイル名(multiLocalized
  UnicodeType)が表示されるようになった（20070625より）
  ※textDescriptionTypeのプロファイル名についてはASCII文字列のみ対応
・"絶対的な色域を維持(2)"のレンダリングインテントにて、Photoshop CS2相当
  の結果が得られるようになった（20070727より）
・分版時に使用したCMYKプロファイルをXCF形式で保存する際、ファイルに含め
  るようになった（0.5.0より）
・前回選択したプロファイルが選択ダイアログのリスト先頭に来るようにした。
  また、リストの上位10件（選択履歴に入っているもの）はダイアログを開く前
  にポップアップメニューから選択できるようにした（0.5.1より）

----- 準備するもの
・The GIMP（バージョン2.2または2.4）

・Separate+プラグイン（Windows用は同梱）

・ICCプロファイル
  sRGBのプロファイルは同梱。Adobe RGBやJapan Color 2001 Coatedといった
  定番プロファイルは、Adobeのサイトよりダウンロードできます。

(Mac)
 http://www.adobe.com/support/downloads/iccprofiles/iccprofiles_mac.html
(Win/Linux)
 http://www.adobe.com/support/downloads/iccprofiles/iccprofiles_win.html

・ICCベースのカラーマネジメントに関する基本的な知識

----- 使い方
まず分版したいレイヤーをアクティブにします。通常は画像を統合することにな
るでしょう。

次に画像ウインドウのメニューより、画像->Separate->色分解（Separate）を選
択します。適当な設定をしてOKをクリックすると4枚のレイヤー（と背景）で構
成される新規画像が作成されます。

それぞれのレイヤーがCMYKの各色に対応していますので、必要に応じて修正やト
ーンカーブ、レベル補正などを行ってもかまいません。ただし、レイヤーやレイ
ヤーマスクを追加・削除してはいけません。修正結果を残しておきたい場合は、
XCF形式で保存しておきます。

分版結果のカラーを画面で確認するには、分版画像のウインドウのメニューより、
画像->Separate->色校正（Proof）を選択します。適当な設定をしてOKをクリッ
クすると、カラー確認用の画像が作成されます。

確認の結果、問題ないと思われるのであれば、TIFF形式で保存しましょう。分版
画像のウインドウのメニューより、画像->Separate->保存（Save）...を選択し
ます。GIMP2.3以降では、環境設定で指定されたプロファイルまたは分版の際に
使用したプロファイルを埋め込むことができます。


----- 環境設定との連動
The GIMPの2.3以降では環境設定に色管理セクションが追加されました。

Separate+プラグインは、ダイアログの初期値を環境設定より取得することがで
きます。プラグインの項目と、環境設定の項目との対応は次の通りです。

	       ソースカラースペース ← RGBプロファイル
	       変換先カラースペース ← CMYKプロファイル
	     レンダリングインテント ← ソフトプルーフ描画方法
	モニタ/作業用カラースペース ← モニタプロファイル
	   分版画像のカラースペース ← 印刷プロファイル
	           プルーフのモード ← ディスプレイ描画方法
	（"彩度"と"絶対的〜"が"紙色のシミュレーション"になります）

※プロファイルが環境設定で未指定であれば、従来どおりplatform.hに記載され
たパスが初期値として使用されます。

ノンインタラクティブで実行する場合、プロファイルのパスは空文字に、レンダ
リングインテントとプルーフのモードは-1に指定しておくと、環境設定の値を取
得するようになります。


----- 動作要件
このプラグインを動作させるには、LittleCMSの1.15以降が必要です。
添付のWindowsバイナリはPentium!!!または互換CPU向けにビルドされています。
動作確認は、Windows版 GIMPのバージョン2.4.5で行いました。


----- Windows版バイナリのインストール
（全ユーザ・個人用共通の手順）
このアーカイブの一次配布サイトでliblcms-1.dll.zipが手に入りますので、こ
れをダウンロードして解凍します。

liblcms-1.dllをGIMPの実行ファイルと同じフォルダにコピーします。分からな
い場合はGIMPのショートカットアイコンを右ボタンクリックしてプロパティを表
示し、リンク先欄を確認しましょう。

この場所には同名のファイルが既にありますので、元々ある方のファイル名を
liblcms-1.dll.oldなどに変更してからコピーしてください。

（全ユーザ用のインストール手順）
GIMPのインストール場所に移動します。例えば次のようなフォルダになります。

	C:\Program Files\GIMP-2.0

分からない場合は場所は先ほど説明した、ショートカットのプロパティから調べ
る方法を利用しましょう。


その場所から、lib→gimp→2.0→plug-insと移動し、そこにseparate.exeと
separate_import.exeをコピーします。

日本語化を有効にしたい場合は、先ほどのインストール場所から、lib（または
share）→locale→ja→LC_MESSAGESと移動し、そこにpoフォルダのja.gmoを
gimp20-separate.moにリネームしてコピーします。

（個人用にインストールする場合）
エクスプローラのアドレス欄に以下の通り入力し移動します。

	%USERPROFILE%\.gimp-2.2\plug-ins

※2.2の部分はGIMPのバージョンにより異なります（2.3など）。

移動先の場所にseparate.exeとseparate_import.exeをコピーします。


----- TIFFインポートプラグイン（付録）
separate_import(.exe)をインストールすることで、Separate+プラグインで分版
するのと同じような状態でCMYKなTIFFファイルを読み込むことができるようにな
ります。
ツールボックスのメニューより、取り込み（Acquire）->分版済みTIFF（Separated
TIFF）を選択するとファイル選択ダイアログが開きます。Windows版
のGIMP2.2.xではファイル名またはフォルダ名に日本語などが含まれると、プラ
グインが強制終了するので注意してください。


----- サンプルスクリプト
プルーフとCMYK TIFF保存の手間を省くQuickproofとQuicksaveを用意しました。
レイヤーを統合→分版→プルーフ（保存） の処理を自動化しています。可視部
分のコピーとペーストを利用しますので、元のレイヤーはそのまま残ります。

GIMP2.3以降用のスクリプトでは、カラースペースとレンダリングインテントの
指定を色管理環境設定より取得します。環境設定にない項目のみ、スクリプトの
ダイアログ上で指定してください。2.2用の方は全て直接指定する必要がありま
す。

"Real black overprinting〜"のオプションを使用すると、アクティブなレイヤ
ーを使ってスミ乗せ処理を行います。このとき、そのレイヤーのカラーは無視さ
れます（スミ乗せだから当然なのですが）。

quickproof.scmとquicksave.scmを所定のスクリプトフォルダにコピーしてくだ
さい。2.2用と2.3以降用をお間違えなく。


----- ビルドする前に
・platform.hにプロファイルのパスの初期値が記述されていますので、必要に応
  じて変更してください。また、基本的に修正する必要はないはずですが、
  iccbutton.cにプロファイル選択ダイアログの検索パスを設定する箇所がありま
  す。
・GIMP2.2用にビルドする場合は、Makefile内の"-DENABLE_COLOR_MANAGEMENT"を
  削除するか、あるいは"make CM="というようにマクロCMを空にしてください。
  この場合、いくつかの機能は無効になります。
・Separate(normal)とSeparate(to Colour)のダイアログ共用を無効化したい場
  合は、Makefile内の"-DSEPARATE_SEPARETE"を削除してください。これにより、
  "plug-in-separate-separate"プロシージャも使用できなくなります。
・複数のバージョンのGIMPがインストールされている環境でビルドする方は、
  pkg-configコマンドが参照する.pcファイルの場所に注意してください。必要
  に応じて、PKG_CONFIG_PATH環境変数を適切に設定してください。
・Windowsでビルドする場合には、MinGW/MSYS環境の利用をおすすめします。
・Mac OS Xでビルドする場合には、gccのコンパイルオプションに"-DMACOSX"を追
  加してください。


----- ライセンス
改変の際追加したコードには、拙作の他のソフトより転用したものが含まれます。

このプラグインのソースコードとして提供される該当箇所は、（当然ながら）オリジナ
ルのコードと同じくGPL2に従ってご利用いただけます。詳しくは、READMEおよび、
COPYINGファイルをご参照ください。



やまかわ
yam at yellowmagic.info
http://cue.yellowmagic.info
